<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <title>ss8_set_len(3) &mdash; Ssstr Manual</title>
  <style>
    body { background: #fff; color: #000; }
    pre { width: fit-content; margin: 0 auto; }
    pre b { color: #1a1a8a; }
    pre i { color: #8a1a1a; }
    pre a b, pre a i { color: inherit; }
    a { color: #0e6e6e; }
    a:visited { color: #551a8a; }
    pre code.highlight { background: #f8f8f8; }
    pre code.highlight .c { color: #8F5902; font-style: italic }
    pre code.highlight .err { color: #A40000 }
    pre code.highlight .g { color: #000 }
    pre code.highlight .k { color: #204A87; font-weight: bold }
    pre code.highlight .l { color: #000 }
    pre code.highlight .n { color: #000 }
    pre code.highlight .o { color: #CE5C00; font-weight: bold }
    pre code.highlight .x { color: #000 }
    pre code.highlight .p { color: #000; font-weight: bold }
    pre code.highlight .ch { color: #8F5902; font-style: italic }
    pre code.highlight .cm { color: #8F5902; font-style: italic }
    pre code.highlight .cp { color: #8F5902; font-style: italic }
    pre code.highlight .cpf { color: #8F5902; font-style: italic }
    pre code.highlight .c1 { color: #8F5902; font-style: italic }
    pre code.highlight .cs { color: #8F5902; font-style: italic }
    pre code.highlight .gd { color: #A40000 }
    pre code.highlight .ge { color: #000; font-style: italic }
    pre code.highlight .ges { color: #000; font-weight: bold; font-style: italic }
    pre code.highlight .gr { color: #EF2929 }
    pre code.highlight .gh { color: #000080; font-weight: bold }
    pre code.highlight .gi { color: #00A000 }
    pre code.highlight .go { color: #000; font-style: italic }
    pre code.highlight .gp { color: #8F5902 }
    pre code.highlight .gs { color: #000; font-weight: bold }
    pre code.highlight .gu { color: #800080; font-weight: bold }
    pre code.highlight .gt { color: #A40000; font-weight: bold }
    pre code.highlight .kc { color: #204A87; font-weight: bold }
    pre code.highlight .kd { color: #204A87; font-weight: bold }
    pre code.highlight .kn { color: #204A87; font-weight: bold }
    pre code.highlight .kp { color: #204A87; font-weight: bold }
    pre code.highlight .kr { color: #204A87; font-weight: bold }
    pre code.highlight .kt { color: #204A87; font-weight: bold }
    pre code.highlight .ld { color: #000 }
    pre code.highlight .m { color: #0000CF; font-weight: bold }
    pre code.highlight .s { color: #4E9A06 }
    pre code.highlight .na { color: #C4A000 }
    pre code.highlight .nb { color: #204A87 }
    pre code.highlight .nc { color: #000 }
    pre code.highlight .no { color: #000 }
    pre code.highlight .nd { color: #5C35CC; font-weight: bold }
    pre code.highlight .ni { color: #CE5C00 }
    pre code.highlight .ne { color: #C00; font-weight: bold }
    pre code.highlight .nf { color: #000 }
    pre code.highlight .nl { color: #F57900 }
    pre code.highlight .nn { color: #000 }
    pre code.highlight .nx { color: #000 }
    pre code.highlight .py { color: #000 }
    pre code.highlight .nt { color: #204A87; font-weight: bold }
    pre code.highlight .nv { color: #000 }
    pre code.highlight .ow { color: #204A87; font-weight: bold }
    pre code.highlight .pm { color: #000; font-weight: bold }
    pre code.highlight .w { color: #F8F8F8 }
    pre code.highlight .mb { color: #0000CF; font-weight: bold }
    pre code.highlight .mf { color: #0000CF; font-weight: bold }
    pre code.highlight .mh { color: #0000CF; font-weight: bold }
    pre code.highlight .mi { color: #0000CF; font-weight: bold }
    pre code.highlight .mo { color: #0000CF; font-weight: bold }
    pre code.highlight .sa { color: #4E9A06 }
    pre code.highlight .sb { color: #4E9A06 }
    pre code.highlight .sc { color: #4E9A06 }
    pre code.highlight .dl { color: #4E9A06 }
    pre code.highlight .sd { color: #8F5902; font-style: italic }
    pre code.highlight .s2 { color: #4E9A06 }
    pre code.highlight .se { color: #4E9A06 }
    pre code.highlight .sh { color: #4E9A06 }
    pre code.highlight .si { color: #4E9A06 }
    pre code.highlight .sx { color: #4E9A06 }
    pre code.highlight .sr { color: #4E9A06 }
    pre code.highlight .s1 { color: #4E9A06 }
    pre code.highlight .ss { color: #4E9A06 }
    pre code.highlight .bp { color: #3465A4 }
    pre code.highlight .fm { color: #000 }
    pre code.highlight .vc { color: #000 }
    pre code.highlight .vg { color: #000 }
    pre code.highlight .vi { color: #000 }
    pre code.highlight .vm { color: #000 }
    pre code.highlight .il { color: #0000CF; font-weight: bold }
    pre code.highlight { display: block; }
    @media (prefers-color-scheme: dark) {
      body { background: #1a1a1a; color: #d4d4d4; }
      pre b { color: #7a9aef; }
      pre i { color: #ef7a7a; }
      a { color: #5ac8c8; }
      a:visited { color: #b07aef; }
      pre code.highlight { background: #272822; color: #F8F8F2 }
      pre code.highlight .c { color: #959077 }
      pre code.highlight .err { color: #ED007E }
      pre code.highlight .esc { color: #F8F8F2 }
      pre code.highlight .g { color: #F8F8F2 }
      pre code.highlight .k { color: #66D9EF }
      pre code.highlight .l { color: #AE81FF }
      pre code.highlight .n { color: #F8F8F2 }
      pre code.highlight .o { color: #FF4689 }
      pre code.highlight .x { color: #F8F8F2 }
      pre code.highlight .p { color: #F8F8F2 }
      pre code.highlight .ch { color: #959077 }
      pre code.highlight .cm { color: #959077 }
      pre code.highlight .cp { color: #959077 }
      pre code.highlight .cpf { color: #959077 }
      pre code.highlight .c1 { color: #959077 }
      pre code.highlight .cs { color: #959077 }
      pre code.highlight .gd { color: #FF4689 }
      pre code.highlight .ge { color: #F8F8F2; font-style: italic }
      pre code.highlight .ges { color: #F8F8F2; font-weight: bold; font-style: italic }
      pre code.highlight .gr { color: #F8F8F2 }
      pre code.highlight .gh { color: #F8F8F2 }
      pre code.highlight .gi { color: #A6E22E }
      pre code.highlight .go { color: #66D9EF }
      pre code.highlight .gp { color: #FF4689; font-weight: bold }
      pre code.highlight .gs { color: #F8F8F2; font-weight: bold }
      pre code.highlight .gu { color: #959077 }
      pre code.highlight .gt { color: #F8F8F2 }
      pre code.highlight .kc { color: #66D9EF }
      pre code.highlight .kd { color: #66D9EF }
      pre code.highlight .kn { color: #FF4689 }
      pre code.highlight .kp { color: #66D9EF }
      pre code.highlight .kr { color: #66D9EF }
      pre code.highlight .kt { color: #66D9EF }
      pre code.highlight .ld { color: #E6DB74 }
      pre code.highlight .m { color: #AE81FF }
      pre code.highlight .s { color: #E6DB74 }
      pre code.highlight .na { color: #A6E22E }
      pre code.highlight .nb { color: #F8F8F2 }
      pre code.highlight .nc { color: #A6E22E }
      pre code.highlight .no { color: #66D9EF }
      pre code.highlight .nd { color: #A6E22E }
      pre code.highlight .ni { color: #F8F8F2 }
      pre code.highlight .ne { color: #A6E22E }
      pre code.highlight .nf { color: #A6E22E }
      pre code.highlight .nl { color: #F8F8F2 }
      pre code.highlight .nn { color: #F8F8F2 }
      pre code.highlight .nx { color: #A6E22E }
      pre code.highlight .py { color: #F8F8F2 }
      pre code.highlight .nt { color: #FF4689 }
      pre code.highlight .nv { color: #F8F8F2 }
      pre code.highlight .ow { color: #FF4689 }
      pre code.highlight .pm { color: #F8F8F2 }
      pre code.highlight .w { color: #F8F8F2 }
      pre code.highlight .mb { color: #AE81FF }
      pre code.highlight .mf { color: #AE81FF }
      pre code.highlight .mh { color: #AE81FF }
      pre code.highlight .mi { color: #AE81FF }
      pre code.highlight .mo { color: #AE81FF }
      pre code.highlight .sa { color: #E6DB74 }
      pre code.highlight .sb { color: #E6DB74 }
      pre code.highlight .sc { color: #E6DB74 }
      pre code.highlight .dl { color: #E6DB74 }
      pre code.highlight .sd { color: #E6DB74 }
      pre code.highlight .s2 { color: #E6DB74 }
      pre code.highlight .se { color: #AE81FF }
      pre code.highlight .sh { color: #E6DB74 }
      pre code.highlight .si { color: #E6DB74 }
      pre code.highlight .sx { color: #E6DB74 }
      pre code.highlight .sr { color: #E6DB74 }
      pre code.highlight .s1 { color: #E6DB74 }
      pre code.highlight .ss { color: #E6DB74 }
      pre code.highlight .bp { color: #F8F8F2 }
      pre code.highlight .fm { color: #A6E22E }
      pre code.highlight .vc { color: #F8F8F2 }
      pre code.highlight .vg { color: #F8F8F2 }
      pre code.highlight .vi { color: #F8F8F2 }
      pre code.highlight .vm { color: #F8F8F2 }
      pre code.highlight .il { color: #AE81FF }
    }
  </style>
</head>
<body>
<pre>
<i>SS8_SET_LEN</i>(3)                   Ssstr Manual                   <i>SS8_SET_LEN</i>(3)

<b>NAME</b>
       ss8_set_len, ss8_grow_len, ss8_set_len_to_cstrlen - set length of ssstr
       byte string

<b>SYNOPSIS</b>
       <b>#include &lt;ss8str.h&gt;</b>

       <b>void ss8_set_len(ss8str *</b><i>str</i><b>, size_t</b> <i>newlen</i><b>);</b>
       <b>size_t ss8_grow_len(ss8str *</b><i>str</i><b>, size_t</b> <i>maxlen</i><b>,</b>
                           <b>size_t</b> <i>maxdelta</i><b>);</b>
       <b>void ss8_set_len_to_cstrlen(ss8str *</b><i>str</i><b>);</b>

<b>DESCRIPTION</b>
       <b>ss8_set_len</b>()  forcefully  sets  the  length  of  the  <b>ss8str</b> at <i>str</i> to
       <i>newlen</i>.  If <i>newlen</i> is less than the current length, the string is trun‐
       cated.  If <i>newlen</i> is greater than the current length, the  new  portion
       of  the string is filled with indeterminate bytes, except that the byte
       after the former last byte is guaranteed to contain a null byte.

       If the capacity of the <b>ss8str</b> is not sufficient to hold the new length,
       it is increased to match the new length; otherwise, no  memory  alloca‐
       tion or deallocation is performed.

       <b>ss8_grow_len</b>()  is  like <b>ss8_set_len</b>(), but automatically chooses a new
       length that is greater than the current length by a constant factor, or
       equal to the current capacity, whichever is larger.  Because the capac‐
       ity is never zero, an appropriate length greater than zero is chosen if
       the current length is zero.

       The amount by which the length is increased is limited to no more  than
       <i>maxdelta</i>,  and  the  final  length  is  limited to no more than <i>maxlen</i>.
       These two parameters can be set to <b>SIZE_MAX</b> to request the maximum  al‐
       lowed limits.

       If  the  current  length  exceeds <i>maxlen</i>, no change is made (the caller
       should avoid this case in typical usage).

       <b>ss8_set_len_to_cstrlen</b>() truncates the <b>ss8str</b> at <i>str</i> to its length when
       viewed as a null-terminated byte string.  That is,

           <b>ss8_set_len_to_cstrlen(</b><i>str</i><b>);</b>

       is equivalent to

           <b>ss8_set_len(</b><i>str</i><b>, strlen(ss8_cstr(</b><i>str</i><b>)));</b>

       No memory allocation or deallocation is performed.

       These functions are intended for the purpose of using an  <b>ss8str</b>  as  a
       destination  when  calling functions that fill a caller-provided buffer
       with a string.  <b>ss8_grow_len</b>() is useful when it is necessary to  retry
       such a function call with successively larger buffers.

<b>RETURN VALUE</b>
       <b>ss8_grow_len</b>() returns the amount (in bytes) by which the length of <i>str</i>
       was  increased.   A  zero return value indicates that the length of <i>str</i>
       was already greater than or equal to <i>maxlen</i>, or that <i>maxdelta</i>  was  set
       to zero.

<b>EXAMPLES</b>
       To read at most 1024 bytes from the file <i>fp</i>:

<code class="highlight"><span class="w">           </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ss8str.h&gt;</span>
<span class="w">           </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="w">           </span><span class="n">ss8str</span><span class="w"> </span><span class="n">bytes</span><span class="p">;</span>
<span class="w">           </span><span class="n">ss8_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bytes</span><span class="p">);</span>

<span class="w">           </span><span class="n">ss8_set_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span>
<span class="w">           </span><span class="kt">size_t</span><span class="w"> </span><span class="n">nread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fread</span><span class="p">(</span><span class="n">ss8_mutable_cstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bytes</span><span class="p">),</span>
<span class="w">                                </span><span class="n">ss8_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bytes</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">fp</span><span class="p">);</span>
<span class="w">           </span><span class="n">ss8_set_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bytes</span><span class="p">,</span><span class="w"> </span><span class="n">nread</span><span class="p">);</span>

<span class="w">           </span><span class="c1">// ...</span>

<span class="w">           </span><span class="n">ss8_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">bytes</span><span class="p">);</span></code>
       To format the current local time:

<code class="highlight"><span class="w">           </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ss8str.h&gt;</span>
<span class="w">           </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdint.h&gt;</span>
<span class="w">           </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;time.h&gt;</span>

<span class="w">           </span><span class="kt">time_t</span><span class="w"> </span><span class="n">now</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">time</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
<span class="w">           </span><span class="n">ss8str</span><span class="w"> </span><span class="n">timestr</span><span class="p">;</span>
<span class="w">           </span><span class="n">ss8_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timestr</span><span class="p">);</span>

<span class="w">           </span><span class="k">for</span><span class="w"> </span><span class="p">(;;)</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="n">ss8_grow_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timestr</span><span class="p">,</span><span class="w"> </span><span class="n">SIZE_MAX</span><span class="p">,</span><span class="w"> </span><span class="n">SIZE_MAX</span><span class="p">);</span>

<span class="w">               </span><span class="c1">// strftime() only returns zero (given &quot;%c&quot;) if the buffer is</span>
<span class="w">               </span><span class="c1">// too small to fit the result.</span>
<span class="w">               </span><span class="kt">size_t</span><span class="w"> </span><span class="n">n</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">strftime</span><span class="p">(</span><span class="n">ss8_mutable_cstr</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timestr</span><span class="p">),</span>
<span class="w">                                   </span><span class="n">ss8_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timestr</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span>
<span class="w">                                   </span><span class="s">&quot;%c&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">localtime</span><span class="p">(</span><span class="o">&amp;</span><span class="n">now</span><span class="p">));</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">n</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                   </span><span class="n">ss8_set_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timestr</span><span class="p">,</span><span class="w"> </span><span class="n">n</span><span class="p">);</span>
<span class="w">                   </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>
<span class="w">           </span><span class="p">}</span>

<span class="w">           </span><span class="c1">// ...</span>

<span class="w">           </span><span class="n">ss8_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">timestr</span><span class="p">);</span></code>
       To read a whole line from the file <i>fp</i>:

<code class="highlight"><span class="w">           </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;ss8str.h&gt;</span>
<span class="w">           </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;limits.h&gt;</span>
<span class="w">           </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdint.h&gt;</span>
<span class="w">           </span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>

<span class="w">           </span><span class="n">ss8str</span><span class="w"> </span><span class="n">line</span><span class="p">;</span>
<span class="w">           </span><span class="n">ss8_init</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">);</span>

<span class="w">           </span><span class="kt">size_t</span><span class="w"> </span><span class="n">nread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">           </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">               </span><span class="c1">// fgets() takes an int count; limit buffer growth accordingly</span>
<span class="w">               </span><span class="kt">int</span><span class="w"> </span><span class="n">growth</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">ss8_grow_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="n">SIZE_MAX</span><span class="p">,</span><span class="w"> </span><span class="n">INT_MAX</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">growth</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">        </span><span class="c1">// Reached limit</span>
<span class="w">                   </span><span class="n">ss8_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">);</span>
<span class="w">                   </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>

<span class="w">               </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">fgets</span><span class="p">(</span><span class="n">ss8_mutable_cstr_suffix</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="n">nread</span><span class="p">),</span>
<span class="w">                          </span><span class="n">growth</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">fp</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">                   </span><span class="n">ss8_clear</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">);</span>
<span class="w">                   </span><span class="k">break</span><span class="p">;</span>
<span class="w">               </span><span class="p">}</span>

<span class="w">               </span><span class="n">ss8_set_len_to_cstrlen</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">);</span>
<span class="w">               </span><span class="n">nread</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ss8_len</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">);</span>
<span class="w">           </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">ss8_ends_with_ch</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">,</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">));</span>

<span class="w">           </span><span class="c1">// ...</span>

<span class="w">           </span><span class="n">ss8_destroy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">line</span><span class="p">);</span></code>
       The  last example is intended for text input that does not contain null
       bytes.  If null bytes do occur, the read line  will  be  silently  cor‐
       rupted but the program will not crash or leak memory.  Other edge cases
       occur  if  the  line  is  longer  than  <b>SIZE_MAX - 1</b> bytes or the input
       reaches end-of-file before a newline.

<b>SEE ALSO</b>
       <a href="../man3/ss8_len.3.html"><b>ss8_len</b>(3)</a>, <a href="../man3/ss8_cstr.3.html"><b>ss8_mutable_cstr</b>(3)</a>, <a href="../man3/ss8_capacity.3.html"><b>ss8_reserve</b>(3)</a>,  <a href="../man3/ss8_capacity.3.html"><b>ss8_shrink_to_fit</b>(3)</a>,
       <a href="../man3/ss8_copy_substr.3.html"><b>ss8_substr_inplace</b>(3)</a>, <a href="../man7/ssstr.7.html"><b>ssstr</b>(7)</a>

SSSTR                             2023-12-30                    <i>SS8_SET_LEN</i>(3)
</pre>
</body>
</html>
